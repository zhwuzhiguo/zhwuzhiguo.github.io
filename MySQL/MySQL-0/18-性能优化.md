# 优化简介

    // show status 语句查询mysql数据库的性能数据
    mysql> show status;
    +-----------------------------------------------+--------------------------------------------------+
    | Variable_name                                 | Value                                            |
    +-----------------------------------------------+--------------------------------------------------+
    | Aborted_clients                               | 0                                                |
    | Aborted_connects                              | 0                                                |
    | Binlog_cache_disk_use                         | 0                                                |
    | Binlog_cache_use                              | 0                                                |
    | Binlog_stmt_cache_disk_use                    | 0                                                |
    | Binlog_stmt_cache_use                         | 0                                                |
    | Bytes_received                                | 249                                              |
    | Bytes_sent                                    | 185                                              |
    | Com_admin_commands                            | 0                                                |
    | Com_assign_to_keycache                        | 0                                                |
    | Com_alter_db                                  | 0                                                |
    | Com_alter_db_upgrade                          | 0                                                |
    | Com_alter_event                               | 0                                                |
    | Com_alter_function                            | 0                                                |
    | Com_alter_instance                            | 0                                                |
    | Com_alter_procedure                           | 0                                                |
    | Com_alter_server                              | 0                                                |
    | Com_alter_table                               | 0                                                |
    | Com_alter_tablespace                          | 0                                                |
    | Com_alter_user                                | 0                                                |
    | Com_analyze                                   | 0                                                |
    | Com_begin                                     | 0                                                |
    | Com_binlog                                    | 0                                                |
    | Com_call_procedure                            | 0                                                |
    | Com_change_db                                 | 0                                                |
    | Com_change_master                             | 0                                                |
    | Com_change_repl_filter                        | 0                                                |
    | Com_check                                     | 0                                                |
    | Com_checksum                                  | 0                                                |
    | Com_commit                                    | 0                                                |
    | Com_create_db                                 | 0                                                |
    | Com_create_event                              | 0                                                |
    | Com_create_function                           | 0                                                |
    | Com_create_index                              | 0                                                |
    | Com_create_procedure                          | 0                                                |
    | Com_create_server                             | 0                                                |
    | Com_create_table                              | 0                                                |
    | Com_create_trigger                            | 0                                                |
    | Com_create_udf                                | 0                                                |
    | Com_create_user                               | 0                                                |
    | Com_create_view                               | 0                                                |
    | Com_dealloc_sql                               | 0                                                |
    | Com_delete                                    | 0                                                |
    | Com_delete_multi                              | 0                                                |
    | Com_do                                        | 0                                                |
    | Com_drop_db                                   | 0                                                |
    | Com_drop_event                                | 0                                                |
    | Com_drop_function                             | 0                                                |
    | Com_drop_index                                | 0                                                |
    | Com_drop_procedure                            | 0                                                |
    | Com_drop_server                               | 0                                                |
    | Com_drop_table                                | 0                                                |
    | Com_drop_trigger                              | 0                                                |
    | Com_drop_user                                 | 0                                                |
    | Com_drop_view                                 | 0                                                |
    | Com_empty_query                               | 0                                                |
    | Com_execute_sql                               | 0                                                |
    | Com_explain_other                             | 0                                                |
    | Com_flush                                     | 0                                                |
    | Com_get_diagnostics                           | 0                                                |
    | Com_grant                                     | 0                                                |
    | Com_ha_close                                  | 0                                                |
    | Com_ha_open                                   | 0                                                |
    | Com_ha_read                                   | 0                                                |
    | Com_help                                      | 0                                                |
    | Com_insert                                    | 0                                                |
    | Com_insert_select                             | 0                                                |
    | Com_install_plugin                            | 0                                                |
    | Com_kill                                      | 0                                                |
    | Com_load                                      | 0                                                |
    | Com_lock_tables                               | 0                                                |
    | Com_optimize                                  | 0                                                |
    | Com_preload_keys                              | 0                                                |
    | Com_prepare_sql                               | 0                                                |
    | Com_purge                                     | 0                                                |
    | Com_purge_before_date                         | 0                                                |
    | Com_release_savepoint                         | 0                                                |
    | Com_rename_table                              | 0                                                |
    | Com_rename_user                               | 0                                                |
    | Com_repair                                    | 0                                                |
    | Com_replace                                   | 0                                                |
    | Com_replace_select                            | 0                                                |
    | Com_reset                                     | 0                                                |
    | Com_resignal                                  | 0                                                |
    | Com_revoke                                    | 0                                                |
    | Com_revoke_all                                | 0                                                |
    | Com_rollback                                  | 0                                                |
    | Com_rollback_to_savepoint                     | 0                                                |
    | Com_savepoint                                 | 0                                                |
    | Com_select                                    | 1                                                |
    | Com_set_option                                | 0                                                |
    | Com_signal                                    | 0                                                |
    | Com_show_binlog_events                        | 0                                                |
    | Com_show_binlogs                              | 0                                                |
    | Com_show_charsets                             | 0                                                |
    | Com_show_collations                           | 0                                                |
    | Com_show_create_db                            | 0                                                |
    | Com_show_create_event                         | 0                                                |
    | Com_show_create_func                          | 0                                                |
    | Com_show_create_proc                          | 0                                                |
    | Com_show_create_table                         | 0                                                |
    | Com_show_create_trigger                       | 0                                                |
    | Com_show_databases                            | 0                                                |
    | Com_show_engine_logs                          | 0                                                |
    | Com_show_engine_mutex                         | 0                                                |
    | Com_show_engine_status                        | 0                                                |
    | Com_show_events                               | 0                                                |
    | Com_show_errors                               | 0                                                |
    | Com_show_fields                               | 0                                                |
    | Com_show_function_code                        | 0                                                |
    | Com_show_function_status                      | 0                                                |
    | Com_show_grants                               | 0                                                |
    | Com_show_keys                                 | 0                                                |
    | Com_show_master_status                        | 0                                                |
    | Com_show_open_tables                          | 0                                                |
    | Com_show_plugins                              | 0                                                |
    | Com_show_privileges                           | 0                                                |
    | Com_show_procedure_code                       | 0                                                |
    | Com_show_procedure_status                     | 0                                                |
    | Com_show_processlist                          | 0                                                |
    | Com_show_profile                              | 0                                                |
    | Com_show_profiles                             | 0                                                |
    | Com_show_relaylog_events                      | 0                                                |
    | Com_show_slave_hosts                          | 0                                                |
    | Com_show_slave_status                         | 0                                                |
    | Com_show_status                               | 1                                                |
    | Com_show_storage_engines                      | 0                                                |
    | Com_show_table_status                         | 0                                                |
    | Com_show_tables                               | 0                                                |
    | Com_show_triggers                             | 0                                                |
    | Com_show_variables                            | 0                                                |
    | Com_show_warnings                             | 0                                                |
    | Com_show_create_user                          | 0                                                |
    | Com_shutdown                                  | 0                                                |
    | Com_slave_start                               | 0                                                |
    | Com_slave_stop                                | 0                                                |
    | Com_group_replication_start                   | 0                                                |
    | Com_group_replication_stop                    | 0                                                |
    | Com_stmt_execute                              | 0                                                |
    | Com_stmt_close                                | 0                                                |
    | Com_stmt_fetch                                | 0                                                |
    | Com_stmt_prepare                              | 0                                                |
    | Com_stmt_reset                                | 0                                                |
    | Com_stmt_send_long_data                       | 0                                                |
    | Com_truncate                                  | 0                                                |
    | Com_uninstall_plugin                          | 0                                                |
    | Com_unlock_tables                             | 0                                                |
    | Com_update                                    | 0                                                |
    | Com_update_multi                              | 0                                                |
    | Com_xa_commit                                 | 0                                                |
    | Com_xa_end                                    | 0                                                |
    | Com_xa_prepare                                | 0                                                |
    | Com_xa_recover                                | 0                                                |
    | Com_xa_rollback                               | 0                                                |
    | Com_xa_start                                  | 0                                                |
    | Com_stmt_reprepare                            | 0                                                |
    | Compression                                   | OFF                                              |
    | Connection_errors_accept                      | 0                                                |
    | Connection_errors_internal                    | 0                                                |
    | Connection_errors_max_connections             | 0                                                |
    | Connection_errors_peer_address                | 0                                                |
    | Connection_errors_select                      | 0                                                |
    | Connection_errors_tcpwrap                     | 0                                                |
    | Connections                                   | 4                                                |
    | Created_tmp_disk_tables                       | 0                                                |
    | Created_tmp_files                             | 6                                                |
    | Created_tmp_tables                            | 0                                                |
    | Delayed_errors                                | 0                                                |
    | Delayed_insert_threads                        | 0                                                |
    | Delayed_writes                                | 0                                                |
    | Flush_commands                                | 1                                                |
    | Handler_commit                                | 0                                                |
    | Handler_delete                                | 0                                                |
    | Handler_discover                              | 0                                                |
    | Handler_external_lock                         | 0                                                |
    | Handler_mrr_init                              | 0                                                |
    | Handler_prepare                               | 0                                                |
    | Handler_read_first                            | 0                                                |
    | Handler_read_key                              | 0                                                |
    | Handler_read_last                             | 0                                                |
    | Handler_read_next                             | 0                                                |
    | Handler_read_prev                             | 0                                                |
    | Handler_read_rnd                              | 0                                                |
    | Handler_read_rnd_next                         | 0                                                |
    | Handler_rollback                              | 0                                                |
    | Handler_savepoint                             | 0                                                |
    | Handler_savepoint_rollback                    | 0                                                |
    | Handler_update                                | 0                                                |
    | Handler_write                                 | 0                                                |
    | Innodb_buffer_pool_dump_status                | Dumping of buffer pool not started               |
    | Innodb_buffer_pool_load_status                | Buffer pool(s) load completed at 171204  9:39:41 |
    | Innodb_buffer_pool_resize_status              |                                                  |
    | Innodb_buffer_pool_pages_data                 | 457                                              |
    | Innodb_buffer_pool_bytes_data                 | 7487488                                          |
    | Innodb_buffer_pool_pages_dirty                | 0                                                |
    | Innodb_buffer_pool_bytes_dirty                | 0                                                |
    | Innodb_buffer_pool_pages_flushed              | 37                                               |
    | Innodb_buffer_pool_pages_free                 | 65071                                            |
    | Innodb_buffer_pool_pages_misc                 | 0                                                |
    | Innodb_buffer_pool_pages_total                | 65528                                            |
    | Innodb_buffer_pool_read_ahead_rnd             | 0                                                |
    | Innodb_buffer_pool_read_ahead                 | 0                                                |
    | Innodb_buffer_pool_read_ahead_evicted         | 0                                                |
    | Innodb_buffer_pool_read_requests              | 1958                                             |
    | Innodb_buffer_pool_reads                      | 423                                              |
    | Innodb_buffer_pool_wait_free                  | 0                                                |
    | Innodb_buffer_pool_write_requests             | 515                                              |
    | Innodb_data_fsyncs                            | 7                                                |
    | Innodb_data_pending_fsyncs                    | 0                                                |
    | Innodb_data_pending_reads                     | 0                                                |
    | Innodb_data_pending_writes                    | 0                                                |
    | Innodb_data_read                              | 7000576                                          |
    | Innodb_data_reads                             | 470                                              |
    | Innodb_data_writes                            | 54                                               |
    | Innodb_data_written                           | 641024                                           |
    | Innodb_dblwr_pages_written                    | 2                                                |
    | Innodb_dblwr_writes                           | 1                                                |
    | Innodb_log_waits                              | 0                                                |
    | Innodb_log_write_requests                     | 0                                                |
    | Innodb_log_writes                             | 2                                                |
    | Innodb_os_log_fsyncs                          | 4                                                |
    | Innodb_os_log_pending_fsyncs                  | 0                                                |
    | Innodb_os_log_pending_writes                  | 0                                                |
    | Innodb_os_log_written                         | 1024                                             |
    | Innodb_page_size                              | 16384                                            |
    | Innodb_pages_created                          | 35                                               |
    | Innodb_pages_read                             | 422                                              |
    | Innodb_pages_written                          | 37                                               |
    | Innodb_row_lock_current_waits                 | 0                                                |
    | Innodb_row_lock_time                          | 0                                                |
    | Innodb_row_lock_time_avg                      | 0                                                |
    | Innodb_row_lock_time_max                      | 0                                                |
    | Innodb_row_lock_waits                         | 0                                                |
    | Innodb_rows_deleted                           | 0                                                |
    | Innodb_rows_inserted                          | 0                                                |
    | Innodb_rows_read                              | 8                                                |
    | Innodb_rows_updated                           | 0                                                |
    | Innodb_num_open_files                         | 39                                               |
    | Innodb_truncated_status_writes                | 0                                                |
    | Innodb_available_undo_logs                    | 128                                              |
    | Key_blocks_not_flushed                        | 0                                                |
    | Key_blocks_unused                             | 6698                                             |
    | Key_blocks_used                               | 7                                                |
    | Key_read_requests                             | 18                                               |
    | Key_reads                                     | 7                                                |
    | Key_write_requests                            | 0                                                |
    | Key_writes                                    | 0                                                |
    | Last_query_cost                               | 0.000000                                         |
    | Last_query_partial_plans                      | 0                                                |
    | Locked_connects                               | 0                                                |
    | Max_execution_time_exceeded                   | 0                                                |
    | Max_execution_time_set                        | 0                                                |
    | Max_execution_time_set_failed                 | 0                                                |
    | Max_used_connections                          | 1                                                |
    | Max_used_connections_time                     | 2017-12-04 10:00:24                              |
    | Not_flushed_delayed_rows                      | 0                                                |
    | Ongoing_anonymous_transaction_count           | 0                                                |
    | Open_files                                    | 10                                               |
    | Open_streams                                  | 0                                                |
    | Open_table_definitions                        | 254                                              |
    | Open_tables                                   | 65                                               |
    | Opened_files                                  | 401                                              |
    | Opened_table_definitions                      | 0                                                |
    | Opened_tables                                 | 0                                                |
    | Performance_schema_accounts_lost              | 0                                                |
    | Performance_schema_cond_classes_lost          | 0                                                |
    | Performance_schema_cond_instances_lost        | 0                                                |
    | Performance_schema_digest_lost                | 0                                                |
    | Performance_schema_file_classes_lost          | 0                                                |
    | Performance_schema_file_handles_lost          | 0                                                |
    | Performance_schema_file_instances_lost        | 0                                                |
    | Performance_schema_hosts_lost                 | 0                                                |
    | Performance_schema_index_stat_lost            | 0                                                |
    | Performance_schema_locker_lost                | 0                                                |
    | Performance_schema_memory_classes_lost        | 0                                                |
    | Performance_schema_metadata_lock_lost         | 0                                                |
    | Performance_schema_mutex_classes_lost         | 0                                                |
    | Performance_schema_mutex_instances_lost       | 0                                                |
    | Performance_schema_nested_statement_lost      | 0                                                |
    | Performance_schema_prepared_statements_lost   | 0                                                |
    | Performance_schema_program_lost               | 0                                                |
    | Performance_schema_rwlock_classes_lost        | 0                                                |
    | Performance_schema_rwlock_instances_lost      | 0                                                |
    | Performance_schema_session_connect_attrs_lost | 0                                                |
    | Performance_schema_socket_classes_lost        | 0                                                |
    | Performance_schema_socket_instances_lost      | 0                                                |
    | Performance_schema_stage_classes_lost         | 0                                                |
    | Performance_schema_statement_classes_lost     | 0                                                |
    | Performance_schema_table_handles_lost         | 0                                                |
    | Performance_schema_table_instances_lost       | 0                                                |
    | Performance_schema_table_lock_stat_lost       | 0                                                |
    | Performance_schema_thread_classes_lost        | 0                                                |
    | Performance_schema_thread_instances_lost      | 0                                                |
    | Performance_schema_users_lost                 | 0                                                |
    | Prepared_stmt_count                           | 0                                                |
    | Qcache_free_blocks                            | 1                                                |
    | Qcache_free_memory                            | 1031832                                          |
    | Qcache_hits                                   | 0                                                |
    | Qcache_inserts                                | 0                                                |
    | Qcache_lowmem_prunes                          | 0                                                |
    | Qcache_not_cached                             | 1                                                |
    | Qcache_queries_in_cache                       | 0                                                |
    | Qcache_total_blocks                           | 1                                                |
    | Queries                                       | 4                                                |
    | Questions                                     | 2                                                |
    | Select_full_join                              | 0                                                |
    | Select_full_range_join                        | 0                                                |
    | Select_range                                  | 0                                                |
    | Select_range_check                            | 0                                                |
    | Select_scan                                   | 0                                                |
    | Slave_open_temp_tables                        | 0                                                |
    | Slow_launch_threads                           | 0                                                |
    | Slow_queries                                  | 0                                                |
    | Sort_merge_passes                             | 0                                                |
    | Sort_range                                    | 0                                                |
    | Sort_rows                                     | 0                                                |
    | Sort_scan                                     | 0                                                |
    | Ssl_accept_renegotiates                       | 0                                                |
    | Ssl_accepts                                   | 0                                                |
    | Ssl_callback_cache_hits                       | 0                                                |
    | Ssl_cipher                                    |                                                  |
    | Ssl_cipher_list                               |                                                  |
    | Ssl_client_connects                           | 0                                                |
    | Ssl_connect_renegotiates                      | 0                                                |
    | Ssl_ctx_verify_depth                          | 0                                                |
    | Ssl_ctx_verify_mode                           | 0                                                |
    | Ssl_default_timeout                           | 0                                                |
    | Ssl_finished_accepts                          | 0                                                |
    | Ssl_finished_connects                         | 0                                                |
    | Ssl_server_not_after                          |                                                  |
    | Ssl_server_not_before                         |                                                  |
    | Ssl_session_cache_hits                        | 0                                                |
    | Ssl_session_cache_misses                      | 0                                                |
    | Ssl_session_cache_mode                        | NONE                                             |
    | Ssl_session_cache_overflows                   | 0                                                |
    | Ssl_session_cache_size                        | 0                                                |
    | Ssl_session_cache_timeouts                    | 0                                                |
    | Ssl_sessions_reused                           | 0                                                |
    | Ssl_used_session_cache_entries                | 0                                                |
    | Ssl_verify_depth                              | 0                                                |
    | Ssl_verify_mode                               | 0                                                |
    | Ssl_version                                   |                                                  |
    | Table_locks_immediate                         | 99                                               |
    | Table_locks_waited                            | 0                                                |
    | Table_open_cache_hits                         | 0                                                |
    | Table_open_cache_misses                       | 0                                                |
    | Table_open_cache_overflows                    | 0                                                |
    | Tc_log_max_pages_used                         | 0                                                |
    | Tc_log_page_size                              | 0                                                |
    | Tc_log_page_waits                             | 0                                                |
    | Threads_cached                                | 0                                                |
    | Threads_connected                             | 1                                                |
    | Threads_created                               | 1                                                |
    | Threads_running                               | 1                                                |
    | Uptime                                        | 1255                                             |
    | Uptime_since_flush_status                     | 1255                                             |
    +-----------------------------------------------+--------------------------------------------------+
    356 rows in set (0.01 sec)

    // 试图连接到(不管是否成功)MySQL服务器的连接数
    mysql> show status like 'Connections';
    +---------------+-------+
    | Variable_name | Value |
    +---------------+-------+
    | Connections   | 4     |
    +---------------+-------+
    1 row in set (0.00 sec)

    // 服务器已经运行的时间（以秒为单位）
    mysql> show status like 'Uptime';
    +---------------+-------+
    | Variable_name | Value |
    +---------------+-------+
    | Uptime        | 1575  |
    +---------------+-------+
    1 row in set (0.00 sec)

    // 慢查询次数
    mysql> show status like 'Slow_queries';
    +---------------+-------+
    | Variable_name | Value |
    +---------------+-------+
    | Slow_queries  | 0     |
    +---------------+-------+
    1 row in set (0.00 sec)

    // 查询操作次数
    mysql> show status like 'Com_select';
    +---------------+-------+
    | Variable_name | Value |
    +---------------+-------+
    | Com_select    | 1     |
    +---------------+-------+
    1 row in set (0.01 sec)

    // 插入操作次数
    mysql> show status like 'Com_insert';
    +---------------+-------+
    | Variable_name | Value |
    +---------------+-------+
    | Com_insert    | 0     |
    +---------------+-------+
    1 row in set (0.00 sec)

    // 更新操作次数
    mysql> show status like 'Com_update';
    +---------------+-------+
    | Variable_name | Value |
    +---------------+-------+
    | Com_update    | 0     |
    +---------------+-------+
    1 row in set (0.00 sec)

    // 删除操作次数
    mysql> show status like 'Com_delete';
    +---------------+-------+
    | Variable_name | Value |
    +---------------+-------+
    | Com_delete    | 0     |
    +---------------+-------+
    1 row in set (0.00 sec)

    // Innodb类型表-select语句查询的记录数
    mysql> show status like 'Innodb_rows_read';
    +------------------+-------+
    | Variable_name    | Value |
    +------------------+-------+
    | Innodb_rows_read | 59    |
    +------------------+-------+
    1 row in set (0.00 sec)

    // Innodb类型表-insert语句插入的记录数
    mysql> show status like 'Innodb_rows_inserted';
    +----------------------+-------+
    | Variable_name        | Value |
    +----------------------+-------+
    | Innodb_rows_inserted | 1     |
    +----------------------+-------+
    1 row in set (0.00 sec)

    // Innodb类型表-update语句更新的记录数
    mysql> show status like 'Innodb_rows_updated';
    +---------------------+-------+
    | Variable_name       | Value |
    +---------------------+-------+
    | Innodb_rows_updated | 3     |
    +---------------------+-------+
    1 row in set (0.00 sec)

    // Innodb类型表-delete删除的记录数
    mysql> show status like 'Innodb_rows_deleted';
    +---------------------+-------+
    | Variable_name       | Value |
    +---------------------+-------+
    | Innodb_rows_deleted | 1     |
    +---------------------+-------+
    1 row in set (0.00 sec)

# 优化查询

* 分析查询语句

    语法

        explain/desc select语句;

    说明

    1. id: select语句编号  
        数字越大越先执行，如果说数字一样大，那么就从上往下依次执行，id列为null的就表是这是一个结果集，不需要使用它来进行查询。
    2. select_type: 
        A：simple：表示不需要union操作或者不包含子查询的简单select查询。有连接查询时，外层的查询为simple，且只有一个  
        B：primary：一个需要union操作或者含有子查询的select，位于最外层的单位查询的select_type即为primary。且只有一个  
        C：union：union连接的两个select查询，第一个查询是dervied派生表，除了第一个表外，第二个以后的表select_type都是union  
        D：dependent union：与union一样，出现在union 或union all语句中，但是这个查询要受到外部查询的影响  
        E：union result：包含union的结果集，在union和union all语句中,因为它不需要参与查询，所以id字段为null  
        F：subquery：除了from字句中包含的子查询外，其他地方出现的子查询都可能是subquery  
        G：dependent subquery：与dependent union类似，表示这个subquery的查询要受到外部表查询的影响  
        H：derived：from字句中出现的子查询，也叫做派生表，其他数据库中可能叫做内联视图或嵌套select  
    3. table: 显示的查询表名  
        如果查询使用了别名，那么这里显示的是别名，  
        如果不涉及对数据表的操作，那么这显示为null，  
        如果显示为尖括号括起来的<derived N>就表示这个是临时表，后边的N就是执行计划中的id，表示结果来自于这个查询产生。  
        如果是尖括号括起来的<union M,N>，与<derived N>类似，也是一个临时表，表示这个结果来自于union查询的id为M,N的结果集。  
    4. partitions: 后续研究。
    5. type: 
        依次从好到差：system，const，eq_ref，ref，fulltext，ref_or_null，unique_subquery，index_subquery，range，index_merge，index，ALL，  
        除了all之外，其他的type都可以使用到索引，  
        除了index_merge之外，其他的type只可以用到一个索引  
        A：system：表中只有一行数据或者是空表，且只能用于myisam和memory表。如果是Innodb引擎表，type列在这个情况通常都是all或者index  
        B：const：使用唯一索引或者主键，返回记录一定是1行记录的等值where条件时，通常type是const。其他数据库也叫做唯一索引扫描  
        C：eq_ref：出现在要连接过个表的查询计划中，驱动表只返回一行数据，且这行数据是第二个表的主键或者唯一索引，且必须为not null，唯一索引和主键是多列时，只有所有的列都用作比较时才会出现eq_ref  
        D：ref：不像eq_ref那样要求连接顺序，也没有主键和唯一索引的要求，只要使用相等条件检索时就可能出现，常见与辅助索引的等值查找。或者多列主键、唯一索引中，使用第一个列之外的列作为等值查找也会出现，总之，返回数据不唯一的等值查找就可能出现。  
        E：fulltext：全文索引检索，要注意，全文索引的优先级很高，若全文索引和普通索引同时存在时，mysql不管代价，优先选择使用全文索引  
        F：ref_or_null：与ref方法类似，只是增加了null值的比较。实际用的不多。  
        G：unique_subquery：用于where中的in形式子查询，子查询返回不重复值唯一值  
        H：index_subquery：用于in形式子查询使用到了辅助索引或者in常数列表，子查询可能返回重复值，可以使用索引将子查询去重。  
        I：range：索引范围扫描，常见于使用>,<,is null,between ,in ,like等运算符的查询中。  
        J：index_merge：表示查询使用了两个以上的索引，最后取交集或者并集，常见and ，or的条件使用了不同的索引，官方排序这个在ref_or_null之后，但是实际上由于要读取多个索引，性能可能大部分时间都不如range  
        K：index：索引全表扫描，把索引从头到尾扫一遍，常见于使用索引列就可以处理不需要读取数据文件的查询、可以使用索引排序或者分组的查询。  
        L：all：这个就是全表扫描数据文件，然后再在server层进行过滤返回符合要求的记录。  
    6. possible_keys:  查询可能使用到的索引都会在这里列出来  
    7. key: 查询真正使用到的索引  
        select_type为index_merge时，这里可能出现两个以上的索引，其他的select_type这里只会出现一个。  
    8. key_len: 用于处理查询的索引长度  
        如果是单列索引，那就整个索引长度算进去，  
        如果是多列索引，那么查询不一定都能使用到所有的列，具体使用到了多少个列的索引，这里就会计算进去，没有使用到的列，这里不会计算进去。  
        留意下这个列的值，算一下你的多列索引总长度就知道有没有使用到所有的列了。  
        要注意，mysql的ICP特性使用到的索引不会计入其中。  
        另外，key_len只计算where条件用到的索引长度，而排序和分组就算用到了索引，也不会计算到key_len中。  
    9. ref:   
        如果是使用的常数等值查询，这里会显示const，  
        如果是连接查询，被驱动表的执行计划这里会显示驱动表的关联字段，  
        如果是条件使用了表达式或者函数，或者条件列发生了内部隐式转换，这里可能显示为func  
    10. rows: 这里是执行计划中估算的扫描行数，不是精确值  
    11. filtered:  
        使用explain extended时会出现这个列，5.7之后的版本默认就有这个字段，不需要使用explain extended了。  
        这个字段表示存储引擎返回的数据在server层过滤后，剩下多少满足查询的记录数量的比例，注意是百分比，不是具体记录数。  
    12. Extra:  
        这个列可以显示的信息非常多，有几十种，常用的有  
        A：distinct：在select部分使用了distinc关键字  
        B：no tables used：不带from字句的查询或者From dual查询  
        C：使用not in()形式子查询或not exists运算符的连接查询，这种叫做反连接。即，一般连接查询是先查询内表，再查询外表，反连接就是先查询外表，再查询内表。  
        D：using filesort：排序时无法使用到索引时，就会出现这个。常见于order by和group by语句中  
        E：using index：查询时不需要回表查询，直接通过索引就可以获取查询的数据。  
        F：using join buffer（block nested loop），using join buffer（batched key accss）：5.6.x之后的版本优化关联查询的BNL，BKA特性。主要是减少内表的循环数量以及比较顺序地扫描查询。  
        G：using sort_union，using_union，using intersect，using sort_intersection：  
            using intersect：表示使用and的各个索引的条件时，该信息表示是从处理结果获取交集  
            using union：表示使用or连接各个使用索引的条件时，该信息表示从处理结果获取并集  
            using sort_union和using sort_intersection：与前面两个对应的类似，只是他们是出现在用and和or查询信息量大时，先查询主键，然后进行排序合并后，才能读取记录并返回。  
        H：using temporary：表示使用了临时表存储中间结果。临时表可以是内存临时表和磁盘临时表，执行计划中看不出来，需要查看status变量，used_tmp_table，used_tmp_disk_table才能看出来。 
        I：using where：表示存储引擎返回的记录并不是所有的都满足查询条件，需要在server层进行过滤。查询条件中分为限制条件和检查条件，5.6之前，存储引擎只能根据限制条件扫描数据并返回，然后server层根据检查条件进行过滤再返回真正符合查询的数据。5.6.x之后支持ICP特性，可以把检查条件也下推到存储引擎层，不符合检查条件和限制条件的数据，直接不读取，这样就大大减少了存储引擎扫描的记录数量。extra列显示using index condition  
        J：firstmatch(tb_name)：5.6.x开始引入的优化子查询的新特性之一，常见于where字句含有in()类型的子查询。如果内表的数据量比较大，就可能出现这个  
        K：loosescan(m..n)：5.6.x之后引入的优化子查询的新特性之一，在in()类型的子查询中，子查询返回的可能有重复记录时，就可能出现这个  
          
        除了这些之外，还有很多查询数据字典库，执行计划过程中就发现不可能存在结果的一些提示信息  

    示例

        mysql> show create table user \G
        *************************** 1. row ***************************
            Table: user
        Create Table: CREATE TABLE `user` (
        `id` int(11) NOT NULL AUTO_INCREMENT,
        `num` char(8) NOT NULL,
        `name` varchar(32) NOT NULL,
        `age` int(11) NOT NULL,
        `height` int(11) NOT NULL,
        `memo` text,
        `create_time` datetime NOT NULL DEFAULT CURRENT_TIMESTAMP,
        PRIMARY KEY (`id`),
        UNIQUE KEY `index_num` (`num`),
        KEY `index_age` (`age`),
        KEY `index_name` (`name`(8))
        ) ENGINE=InnoDB AUTO_INCREMENT=11 DEFAULT CHARSET=utf8
        1 row in set (0.00 sec)

        mysql> select * from user;
        +----+-----+--------+-----+--------+------+---------------------+
        | id | num | name   | age | height | memo | create_time         |
        +----+-----+--------+-----+--------+------+---------------------+
        |  3 | 003 | 王五   |  30 |    180 | NULL | 2017-11-23 10:35:39 |
        |  4 | 004 | 赵六   |  30 |    180 | NULL | 2017-11-23 10:40:40 |
        |  5 | 005 | 马七   |  20 |    180 | NULL | 2017-11-23 10:40:40 |
        |  6 | 006 | 羊八   |  30 |    180 | NULL | 2017-11-23 10:40:40 |
        |  7 | 007 | uuu    |  40 |    180 | NULL | 2017-11-23 10:40:40 |
        |  8 | 008 | uuu    |  50 |    180 | NULL | 2017-11-23 10:40:40 |
        |  9 | 009 | uuu    |  60 |    180 | NULL | 2017-11-23 10:40:40 |
        +----+-----+--------+-----+--------+------+---------------------+
        7 rows in set (0.00 sec)

        mysql> select * from user
            -> where id > (select id from user where name = '赵六')
            -> and age > 30;
        +----+-----+------+-----+--------+------+---------------------+
        | id | num | name | age | height | memo | create_time         |
        +----+-----+------+-----+--------+------+---------------------+
        |  7 | 007 | uuu  |  40 |    180 | NULL | 2017-11-23 10:40:40 |
        |  8 | 008 | uuu  |  50 |    180 | NULL | 2017-11-23 10:40:40 |
        |  9 | 009 | uuu  |  60 |    180 | NULL | 2017-11-23 10:40:40 |
        +----+-----+------+-----+--------+------+---------------------+
        3 rows in set (0.00 sec)

        mysql> explain
            -> select * from user
            -> where id > (select id from user where name = '赵六')
            -> and age > 30;
        +----+-------------+-------+------------+-------+-------------------+------------+---------+-------+------+----------+-------------+
        | id | select_type | table | partitions | type  | possible_keys     | key        | key_len | ref   | rows | filtered | Extra       |
        +----+-------------+-------+------------+-------+-------------------+------------+---------+-------+------+----------+-------------+
        |  1 | PRIMARY     | user  | NULL       | range | PRIMARY,index_age | PRIMARY    | 4       | NULL  |    5 |    42.86 | Using where |
        |  2 | SUBQUERY    | user  | NULL       | ref   | index_name        | index_name | 26      | const |    1 |   100.00 | Using where |
        +----+-------------+-------+------------+-------+-------------------+------------+---------+-------+------+----------+-------------+
        2 rows in set, 1 warning (0.00 sec)

* 索引对查询速度的影响

    通过索引查询能提高查询效率。

* 使用索引查询

    1. 查询语句中使用like关键字

        如果匹配字符串的第一个字符是%则索引不会被使用，否则会使用索引。

            mysql> explain select * from user where name like 'uu%';
            +----+-------------+-------+------------+-------+---------------+------------+---------+------+------+----------+-------------+
            | id | select_type | table | partitions | type  | possible_keys | key        | key_len | ref  | rows | filtered | Extra       |
            +----+-------------+-------+------------+-------+---------------+------------+---------+------+------+----------+-------------+
            |  1 | SIMPLE      | user  | NULL       | range | index_name    | index_name | 26      | NULL |    2 |   100.00 | Using where |
            +----+-------------+-------+------------+-------+---------------+------------+---------+------+------+----------+-------------+
            1 row in set, 1 warning (0.00 sec)

            mysql> explain select * from user where name like '%uu%';
            +----+-------------+-------+------------+------+---------------+------+---------+------+------+----------+-------------+
            | id | select_type | table | partitions | type | possible_keys | key  | key_len | ref  | rows | filtered | Extra       |
            +----+-------------+-------+------------+------+---------------+------+---------+------+------+----------+-------------+
            |  1 | SIMPLE      | user  | NULL       | ALL  | NULL          | NULL | NULL    | NULL |    7 |    14.29 | Using where |
            +----+-------------+-------+------------+------+---------------+------+---------+------+------+----------+-------------+
            1 row in set, 1 warning (0.00 sec)

    2. 查询语句中使用多列索引

        查询条件使用了多列字段的第一个字段时，会使用索引，否则不会。

            mysql> desc product;
            +-------------+----------+------+-----+-------------------+-------+
            | Field       | Type     | Null | Key | Default           | Extra |
            +-------------+----------+------+-----+-------------------+-------+
            | name        | char(8)  | NO   | PRI | NULL              |       |
            | number      | char(8)  | NO   | PRI | NULL              |       |
            | memo        | text     | YES  |     | NULL              |       |
            | create_time | datetime | NO   |     | CURRENT_TIMESTAMP |       |
            +-------------+----------+------+-----+-------------------+-------+
            4 rows in set (0.00 sec)

            mysql> explain select * from product where name = 'desk';
            +----+-------------+---------+------------+------+---------------+---------+---------+-------+------+----------+-------+
            | id | select_type | table   | partitions | type | possible_keys | key     | key_len | ref   | rows | filtered | Extra |
            +----+-------------+---------+------------+------+---------------+---------+---------+-------+------+----------+-------+
            |  1 | SIMPLE      | product | NULL       | ref  | PRIMARY       | PRIMARY | 24      | const |    2 |   100.00 | NULL  |
            +----+-------------+---------+------------+------+---------------+---------+---------+-------+------+----------+-------+
            1 row in set, 1 warning (0.00 sec)

            mysql> explain select * from product where number = '001';
            +----+-------------+---------+------------+------+---------------+------+---------+------+------+----------+-------------+
            | id | select_type | table   | partitions | type | possible_keys | key  | key_len | ref  | rows | filtered | Extra       |
            +----+-------------+---------+------------+------+---------------+------+---------+------+------+----------+-------------+
            |  1 | SIMPLE      | product | NULL       | ALL  | NULL          | NULL | NULL    | NULL |    4 |    25.00 | Using where |
            +----+-------------+---------+------------+------+---------------+------+---------+------+------+----------+-------------+
            1 row in set, 1 warning (0.00 sec)


    3. 查询语句中使用or关键字

        查询条件中or前后的多个条件如果全使用索引则使用索引查询，否则不使用索引。  
        
            mysql> explain select * from user where age = 30 or name like 'xx%';
            +----+-------------+-------+------------+-------------+----------------------+----------------------+---------+------+------+----------+-----------------------------------------------------+
            | id | select_type | table | partitions | type        | possible_keys        | key                  | key_len | ref  | rows | filtered | Extra                                               |
            +----+-------------+-------+------------+-------------+----------------------+----------------------+---------+------+------+----------+-----------------------------------------------------+
            |  1 | SIMPLE      | user  | NULL       | index_merge | index_age,index_name | index_age,index_name | 4,26    | NULL |    3 |   100.00 | Using sort_union(index_age,index_name); Using where |
            +----+-------------+-------+------------+-------------+----------------------+----------------------+---------+------+------+----------+-----------------------------------------------------+
            1 row in set, 1 warning (0.00 sec)

            mysql> explain select * from user where age = 30 or name like '%xx%';
            +----+-------------+-------+------------+------+---------------+------+---------+------+------+----------+-------------+
            | id | select_type | table | partitions | type | possible_keys | key  | key_len | ref  | rows | filtered | Extra       |
            +----+-------------+-------+------------+------+---------------+------+---------+------+------+----------+-------------+
            |  1 | SIMPLE      | user  | NULL       | ALL  | index_age     | NULL | NULL    | NULL |   48 |    13.00 | Using where |
            +----+-------------+-------+------------+------+---------------+------+---------+------+------+----------+-------------+
            1 row in set, 1 warning (0.01 sec)

            mysql> explain select * from user where age = 30 and name like '%xx%';
            +----+-------------+-------+------------+------+---------------+-----------+---------+-------+------+----------+-------------+
            | id | select_type | table | partitions | type | possible_keys | key       | key_len | ref   | rows | filtered | Extra       |
            +----+-------------+-------+------------+------+---------------+-----------+---------+-------+------+----------+-------------+
            |  1 | SIMPLE      | user  | NULL       | ref  | index_age     | index_age | 4       | const |    2 |    11.11 | Using where |
            +----+-------------+-------+------------+------+---------------+-----------+---------+-------+------+----------+-------------+
            1 row in set, 1 warning (0.00 sec)


* 优化子查询

    子查询需要为内层查询语句建立一个临时表，外层查询再使用临时表查询，查询完毕后需要撤销临时表，因此子查询的速度会受一定的影响。  
    最好使用连接查询来替代子查询，速度更快。  
    **这个后续需要研究一下**

# 优化数据库结构

* 将字段很多的表分解成多个表

    当一个表的字段很多，有一些字段使用频率很低。当数据量大时，查询数据的速度就会很慢。  
    这种情况可以分解成多个表，不常用字段独立出一个表来。  
    当需要查询不常用字段时，可以关联查询即可。  

* 增加中间表

    经常需要联合查询多个表，这时可以建立一个中间表，放需要查询的字段，来提高查询性能。  
    但需要多维护一个中间表。

* 增加冗余字段

    适当的增加冗余字段也能减少连接查询，提高查询效率。

* 优化插入记录的速度

    1. 禁用索引

            // 禁用
            alter table 表名 disable keys;
            // 启用
            alter table 表名 enable keys;

    2. 禁用唯一性检查

            // 禁用
            set unique_checks = 0;
            // 启用
            set unique_checks = 1;

    2. 优化insert语句

            // 使用一个insert语句插入多条记录能减少数据库连接操作，从而提高效率
            insert into tablename values 
            (value1, value2, ...),
            (value1, value2, ...),
            ...
            (value1, value2, ...);

        **注意**  
        load data infile 语句比insert语句速度更快。

* 分析表、检查表和优化表

        // 分析表
        // 针对InnoDB和MyISAM类型表
        // 会对表加只读锁
        // 主要作用是分析关键字分布
        mysql> analyze table user;
        +-------------+---------+----------+----------+
        | Table       | Op      | Msg_type | Msg_text |
        +-------------+---------+----------+----------+
        | tempdb.user | analyze | status   | OK       |
        +-------------+---------+----------+----------+
        1 row in set (0.01 sec)

        // 检查表
        // 针对InnoDB和MyISAM类型表
        // 会对表加只读锁
        // 主要作用是检查表是否存在错误
        mysql> check table user;
        +-------------+-------+----------+----------+
        | Table       | Op    | Msg_type | Msg_text |
        +-------------+-------+----------+----------+
        | tempdb.user | check | status   | OK       |
        +-------------+-------+----------+----------+
        1 row in set (0.00 sec)

        // 优化表
        // 针对InnoDB和MyISAM类型表
        // 会对表加只读锁
        // 主要作用是消除删除或更新造成的空间浪费
        mysql> optimize table user;
        +-------------+----------+----------+-------------------------------------------------------------------+
        | Table       | Op       | Msg_type | Msg_text                                                          |
        +-------------+----------+----------+-------------------------------------------------------------------+
        | tempdb.user | optimize | note     | Table does not support optimize, doing recreate + analyze instead |
        | tempdb.user | optimize | status   | OK                                                                |
        +-------------+----------+----------+-------------------------------------------------------------------+
        2 rows in set (0.09 sec)


# 优化服务器

* 优化服务器硬件

    增加内存，提高硬盘读写速度都能提高数据库性能。  
    通过镜像机制可以将不同计算机上的数据库数据同步，通过不同的服务器来提供数据库服务，可以降低单个数据库服务器压力，从而提高数据库性能。

* 优化mysql参数

    **这个后续需要升入，这里暂不研究**



# 完。