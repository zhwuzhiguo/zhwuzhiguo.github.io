# 04-深入浅出索引（上）

在 MySQL 中，索引是在存储引擎层实现的，所以并没有统一的索引标准，即不同存储引擎的索引的工作方式并不一样。

## InnoDB 的索引模型

InnoDB 使用了 `B+` 树索引模型，所以数据都是存储在 `B+` 树中的。

每一个索引在 InnoDB 里面对应一棵 `B+` 树。

在 InnoDB 里，主键索引也被称为`聚簇索引`，叶子节点存的是整行数据。

在 InnoDB 里，非主键索引也被称为`二级索引`，叶子节点内容是键值和主键值。

基于非主键索引的查询需要`回表`。

## 索引维护

`B+` 树为了维护索引有序性，在插入新值的时候需要做必要的维护。

当插入记录的主键不是自增的时候，记录会插入到 `B+` 树中间的某个页中，当这个页已经满了的时候，就需要进行`页分裂`，这种情况性能自然会受影响。

除了性能外，页分裂操作还影响数据页的利用率。原本放在一个页的数据，现在分到两个页中，整体空间利用率降低大约 `50%` 。

当相邻两个页由于删除了数据，利用率很低之后，也会进行`页合并`。

所以一般要求建表语句里一定要有`自增主键`。

自增主键的表每次插入一条新记录，都是追加操作，不涉及挪动其他记录，也不会触发叶子节点的分裂。

从存储空间的角度来看，自增主键一般使用整型（`4字节`）或长整型（`8字节`），占用空间相对较少。

另外二级索引的叶子节点上都要存放主键，所以主键长度越小，二级索引的叶子节点就越小，占用的空间也就越小。

所以，从性能和存储空间方面考量，自增主键往往是更合理的选择。

特殊的，对于一些字典之类的表，可以使用业务`key`作为主键，这种表一般只按主键查询，也不需要建二级索引，也就不需要考虑二级索引叶子节点大小的问题了。

## 小结

`B+` 树能够很好地配合磁盘的读写特性，减少单次查询的磁盘访问次数。

一般情况下建议创建自增主键的表，这样聚簇索引的插入效率更高，二级索引占用的空间也更小。

# 完